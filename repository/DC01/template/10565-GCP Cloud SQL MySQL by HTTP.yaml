zabbix_export:
  version: '6.0'
  date: '2024-08-25T12:07:57Z'
  groups:
    - uuid: c2c162144c2d4c5491c8801193af4945
      name: Templates/Cloud
  templates:
    - uuid: 38456af4aedd4b168ec3fa4ad2acb256
      template: 'GCP Cloud SQL MySQL by HTTP'
      name: 'GCP Cloud SQL MySQL by HTTP'
      description: |
        Get GCP Cloud SQL MySQL instances monitoring with script item usage to perform HTTP requests to Google Cloud Platform Monitoring API.
        This template will be automatically connected to discovered entities with all their required parameters pre-defined.
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback.
        
        
        Generated by official Zabbix template tool "Templator"
      groups:
        - name: Templates/Cloud
      items:
        - uuid: 83e36c61e8ce4d06a395ea7b06c5877b
          name: 'GCP Cloud SQL MySQL: Reserved CPU cores'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.cpu.reserved_cores
          delay: '0'
          history: 7d
          trends: 90d
          value_type: FLOAT
          description: 'Number of cores reserved for the database.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_reserved_cores
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: cpu
        - uuid: a39ba253dbf24110af48fd49572976fd
          name: 'GCP Cloud SQL MySQL: CPU usage time'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.cpu.usage_time
          delay: '0'
          history: 7d
          trends: 90d
          value_type: FLOAT
          units: s
          description: 'Cumulative CPU usage time in seconds.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_usage_time
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: cpu
        - uuid: df7469e3c76c4286846c27003c9785cc
          name: 'GCP Cloud SQL MySQL: CPU utilization'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.cpu.utilization
          delay: '0'
          history: 7d
          trends: 90d
          value_type: FLOAT
          units: '%'
          description: 'Current CPU utilization represented as a percentage of the reserved CPU that is currently in use.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_utilization
            - type: MULTIPLIER
              parameters:
                - '100'
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: 5bf54c01665549c8a05f49db34c86191
              expression: 'min(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.cpu.utilization,5m) >= {$CLOUD_SQL.MYSQL.CPU.UTIL.MAX}'
              name: 'GCP Cloud SQL MySQL: High CPU utilization'
              opdata: 'Current utilization: {ITEM.LASTVALUE}'
              priority: AVERAGE
              description: 'The CPU utilization is too high. The system might be slow to respond.'
              tags:
                - tag: scope
                  value: performance
        - uuid: 948dac37023c4efcaf5f830ba5d4fafe
          name: 'GCP Cloud SQL MySQL: DB engine state'
          type: HTTP_AGENT
          key: gcp.cloudsql.mysql.db.state
          history: 7d
          description: 'GCP Cloud SQL MySQL DB Engine State.'
          valuemap:
            name: 'Database availability'
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - ''
            - type: JSONPATH
              parameters:
                - '$.timeSeriesData[0].pointData[0].values[0].int64Value'
              error_handler: DISCARD_VALUE
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          timeout: '{$GCP.DATA.TIMEOUT}'
          url: 'https://monitoring.googleapis.com/v3/projects/{$GCP.PROJECT.ID}/timeSeries:query'
          posts: '{"query":"cloudsql.googleapis.com/database/up | within 5m | filter database_id = ''{$GCP.PROJECT.ID}:{HOST.NAME}''"}'
          status_codes: ''
          headers:
            - name: Content-Type
              value: application/json
            - name: Authorization
              value: 'Bearer {$GCP.AUTH.TOKEN}'
          request_method: POST
          tags:
            - tag: component
              value: status
          triggers:
            - uuid: a3eff8c422f5427e9b1c6abb9854f73c
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.db.state)=0'
              name: 'GCP Cloud SQL MySQL: Database engine is down'
              priority: AVERAGE
              description: |
                Database engine is down.
                If an instance experiences unplanned (non-maintenance) downtime, the instance state will still be RUNNING, but the database engine state metric will report 0.
              dependencies:
                - name: 'GCP Cloud SQL MySQL: Failed to get the instance state'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 10'
                - name: 'GCP Cloud SQL MySQL: Instance is in failed state'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 5'
                - name: 'GCP Cloud SQL MySQL: Instance is in maintenance'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 4'
                - name: 'GCP Cloud SQL MySQL: Instance is in suspended state'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 1'
                - name: 'GCP Cloud SQL MySQL: Instance is in unknown state'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 6'
                - name: 'GCP Cloud SQL MySQL: Instance is stopped by the owner'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 2'
              tags:
                - tag: scope
                  value: availability
        - uuid: 76c37760145d43f3927f1a9548dea8a5
          name: 'GCP Cloud SQL MySQL: Disk bytes used'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.disk.bytes_used
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Data utilization in bytes.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_bytes_used
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: storage
        - uuid: 464fecbbedd64e988739c93736d2b824
          name: 'GCP Cloud SQL MySQL: Disk size'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.disk.quota
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Maximum data disk size in bytes.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_quota
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: storage
        - uuid: d426d282d2ee43fe9c9b64dcb6d0c4c9
          name: 'GCP Cloud SQL MySQL: Disk read I/O'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.disk.read_ops_count
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta count of data disk read I/O operations.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_read_ops_count
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: storage
        - uuid: b2274d47be5041b493b00fd55172c0e9
          name: 'GCP Cloud SQL MySQL: Disk utilization'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.disk.utilization
          delay: '0'
          history: 7d
          trends: 90d
          value_type: FLOAT
          units: '%'
          description: |
            The fraction of the disk quota that is currently in use.
            Shown as percentage.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_utilization
            - type: MULTIPLIER
              parameters:
                - '100'
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: storage
          triggers:
            - uuid: d5ade16fb0494ca6af61100a2e643702
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.disk.utilization) >= {$CLOUD_SQL.MYSQL.DISK.UTIL.CRIT}'
              name: 'GCP Cloud SQL MySQL: Disk space is critically low'
              opdata: 'Current utilization: {ITEM.LASTVALUE}'
              priority: AVERAGE
              description: 'Critical utilization of the disk space.'
              tags:
                - tag: scope
                  value: capacity
            - uuid: 3b5c84fee47f4376b19d0738b261c01b
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.disk.utilization) >= {$CLOUD_SQL.MYSQL.DISK.UTIL.WARN}'
              name: 'GCP Cloud SQL MySQL: Disk space is low'
              opdata: 'Current utilization: {ITEM.LASTVALUE}'
              priority: WARNING
              description: 'High utilization of the storage space.'
              dependencies:
                - name: 'GCP Cloud SQL MySQL: Disk space is critically low'
                  expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.disk.utilization) >= {$CLOUD_SQL.MYSQL.DISK.UTIL.CRIT}'
              tags:
                - tag: scope
                  value: capacity
        - uuid: 7a44187c6a404defb0dc83fa22f89d96
          name: 'GCP Cloud SQL MySQL: Disk write I/O'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.disk.write_ops_count
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta count of data disk write I/O operations.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_write_ops_count
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: storage
        - uuid: 5e5b9cdfa7f2455b881cceface136e65
          name: 'GCP Cloud SQL MySQL: InnoDB dirty pages'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_buffer_pool_pages_dirty
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Number of unflushed pages in the InnoDB buffer pool.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_buffer_pool_pages_dirty
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 75835c8326e6461d8f25fb7d55271f16
          name: 'GCP Cloud SQL MySQL: InnoDB free pages'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_buffer_pool_pages_free
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Number of unused pages in the InnoDB buffer pool.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_buffer_pool_pages_free
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 080d5304c0e346808bd70b125a27be4b
          name: 'GCP Cloud SQL MySQL: InnoDB total pages'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_buffer_pool_pages_total
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Total number of pages in the InnoDB buffer pool.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_buffer_pool_pages_total
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 19e259f61fc24e29a189c35121878eb3
          name: 'GCP Cloud SQL MySQL: InnoDB fsync calls'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_data_fsyncs
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta count of InnoDB fsync() calls.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_data_fsyncs
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: storage
        - uuid: c4a4ffa274974041bccbd25643ff9f70
          name: 'GCP Cloud SQL MySQL: InnoDB log fsync calls'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_os_log_fsyncs
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta count of InnoDB fsync() calls to the log file.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_os_log_fsyncs
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: storage
        - uuid: 4a9154e235e84c0d9dbf0abf44479f49
          name: 'GCP Cloud SQL MySQL: InnoDB pages read'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_pages_read
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta count of InnoDB pages read.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_pages_read
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 584714b219034bbebbc24edad36704c9
          name: 'GCP Cloud SQL MySQL: InnoDB pages written'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.innodb_pages_written
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta count of InnoDB pages written.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_innodb_pages_written
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 71559008ad444772b0b1212f715980ed
          name: 'GCP Cloud SQL MySQL: Instance state'
          type: HTTP_AGENT
          key: gcp.cloudsql.mysql.inst.state
          history: 7d
          description: 'GCP Cloud SQL MySQL Current instance state.'
          valuemap:
            name: 'Instance state'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.timeSeriesData[0].pointData[0].values[0].stringValue'
              error_handler: CUSTOM_VALUE
              error_handler_params: '10'
            - type: JAVASCRIPT
              parameters:
                - |
                  const idx = [
                  	'RUNNING',
                  	'SUSPENDED',
                  	'RUNNABLE',
                  	'PENDING_CREATE',
                  	'MAINTENANCE',
                  	'FAILED',
                  	'UNKNOWN_STATE'
                  ].indexOf(value);
                  return idx !== -1 ? idx : 10;
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          timeout: '{$GCP.DATA.TIMEOUT}'
          url: 'https://monitoring.googleapis.com/v3/projects/{$GCP.PROJECT.ID}/timeSeries:query'
          posts: '{"query":"cloudsql.googleapis.com/database/state | within 5m | filter database_id = ''{$GCP.PROJECT.ID}:{HOST.NAME}''"}'
          status_codes: ''
          headers:
            - name: Content-Type
              value: application/json
            - name: Authorization
              value: 'Bearer {$GCP.AUTH.TOKEN}'
          request_method: POST
          tags:
            - tag: component
              value: status
          triggers:
            - uuid: 3b3adc89e0bb45a79a824121f49d2d02
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 10'
              name: 'GCP Cloud SQL MySQL: Failed to get the instance state'
              priority: AVERAGE
              description: |
                Failed to get the instance state. 
                Check access permissions to GCP API or service account.
              tags:
                - tag: scope
                  value: availability
            - uuid: 65831fed3d19425c86933db4034ed565
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 5'
              name: 'GCP Cloud SQL MySQL: Instance is in failed state'
              priority: AVERAGE
              description: 'The instance creation failed, or an operation left the instance in an own bad state.'
              tags:
                - tag: scope
                  value: availability
            - uuid: fae15d1ab46c418ebfdfdd73fb698b51
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 4'
              name: 'GCP Cloud SQL MySQL: Instance is in maintenance'
              priority: INFO
              description: 'The instance is down for maintenance.'
              tags:
                - tag: scope
                  value: availability
            - uuid: 347215d307c8465cad41198f12b5ff68
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 1'
              name: 'GCP Cloud SQL MySQL: Instance is in suspended state'
              priority: WARNING
              description: |
                The instance is in suspended state. 
                It is not available, for example, due to problems with billing.
              tags:
                - tag: scope
                  value: availability
            - uuid: 1387f9a2ef194d5bb5d1e548fc4eb8d3
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 6'
              name: 'GCP Cloud SQL MySQL: Instance is in unknown state'
              priority: AVERAGE
              description: 'The state of the instance is unknown.'
              tags:
                - tag: scope
                  value: availability
            - uuid: 9c66317433a24be985559fdb11907c70
              expression: 'last(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.inst.state) = 2'
              name: 'GCP Cloud SQL MySQL: Instance is stopped by the owner'
              priority: INFO
              description: |
                The instance has been stopped by the owner. 
                It is not currently running, but it's ready to be restarted.
              tags:
                - tag: scope
                  value: availability
        - uuid: cc09f5591b0242b3b99199b267a1c527
          name: 'GCP Cloud SQL MySQL: Memory size'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.memory.quota
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Maximum RAM size in bytes.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_quota
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: memory
        - uuid: 13868b9408c9489296531bf1fd927084
          name: 'GCP Cloud SQL MySQL: Memory used by DB engine'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.memory.total_usage
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: |
            Total RAM usage in bytes.
            This metric reports the RAM usage of the database process, including the buffer/cache.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_total_usage
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: memory
        - uuid: 995d07fc814f4d12a9c9bdc6bb52481d
          name: 'GCP Cloud SQL MySQL: Memory usage'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.memory.usage
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: |
            The RAM usage in bytes.
            This metric reports the RAM usage of the server, excluding the buffer/cache.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_usage
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: memory
        - uuid: efe4357a63ec43f799b2303a952c1378
          name: 'GCP Cloud SQL MySQL: Memory utilization'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.memory.utilization
          delay: '0'
          history: 7d
          trends: 90d
          value_type: FLOAT
          units: '%'
          description: |
            The fraction of the memory quota that is currently in use.
            Shown as percentage.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_ram_pused
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: 82e3af43d3104b4ba641e0be56d11662
              expression: 'min(/GCP Cloud SQL MySQL by HTTP/gcp.cloudsql.mysql.memory.utilization,5m) >= {$CLOUD_SQL.MYSQL.RAM.UTIL.MAX}'
              name: 'GCP Cloud SQL MySQL: High memory utilization'
              opdata: 'Current utilization: {ITEM.LASTVALUE}'
              priority: HIGH
              description: 'RAM utilization is too high. The system might be slow to respond.'
              tags:
                - tag: scope
                  value: performance
        - uuid: 682484eaf1db4a239c69566a5cd492e2
          name: 'GCP Cloud SQL MySQL: Metrics get'
          type: SCRIPT
          key: gcp.cloudsql.mysql.metrics.get
          delay: '{$GCP.TIME.WINDOW}'
          history: '0'
          trends: '0'
          value_type: TEXT
          params: |
            var base_path = 'cloudsql.googleapis.com/database/',
            	mysql_path = 'cloudsql.googleapis.com/database/mysql/',
            	obj = {},
            	base_paths = [
            		'cpu/reserved_cores',
            		'cpu/usage_time',
            		'cpu/utilization',
            		'disk/read_ops_count',
            		'disk/write_ops_count',
            		'memory/quota',
            		'memory/total_usage',
            		'memory/usage',
            		'network/connections',
            		'network/received_bytes_count',
            		'network/sent_bytes_count  | map ignore [destination]'
            	].map(function (path) { return base_path + path; }),
            	mysql_paths = [
            		'innodb_buffer_pool_pages_dirty',
            		'innodb_buffer_pool_pages_free',
            		'innodb_buffer_pool_pages_total',
            		'innodb_data_fsyncs',
            		'innodb_os_log_fsyncs',
            		'innodb_pages_read',
            		'innodb_pages_written',
            		'queries',
            		'questions',
            		'received_bytes_count',
            		'sent_bytes_count',
            		'open_tables',
            		'open_table_definitions'
            	].map(function (path) { return mysql_path + path; }).concat(
            		['disk/bytes_used', 'disk/utilization', 'disk/quota'].map(function (path) { return base_path + path; }));
            
            function getField(data, path) {
            	var steps = path.split('.');
            
            	for (var i = 0; i < steps.length; i++) {
            		var step = steps[i];
            
            		if (typeof data !== 'object' || typeof data[step] === 'undefined') {
            			throw 'Required field "' + path + '" is not present in data received.';
            		}
            		data = data[step];
            	}
            	return data;
            }
            
            function checkParams(params) {
            	['project_id', 'time_window', 'database_id', 'token'].forEach(function (field) {
            		if (typeof params !== 'object' || typeof params[field] === 'undefined' || params[field] === '') {
            			throw 'Required param is not set: ' + field + '.';
            		}
            	});
            	if (!params.time_window.match(/^[0-9]+(m|h)$/)) {
            		throw 'Incorrect update interval for parameter  time_window. Valid ranges 1m-23h.';
            	}
            	return params;
            }
            
            function getHttpData(url, token, body) {
            	var request = new HttpRequest();
            	if (typeof params.proxy !== 'undefined' && params.proxy !== '') {
            		request.setProxy(params.proxy);
            	};
            	request.addHeader('Authorization: Bearer ' + token);
            	request.addHeader('Content-Type: application/json');
            
            	var response = request.post(url, JSON.stringify(body));
            
            	Zabbix.log(4, '[ GCP API ] [ ' + url + ' ] Received response with status code ' + request.getStatus() + ': ' + response);
            
            	if (response !== null) {
            		try {
            			response = JSON.parse(response);
            		}
            		catch (error) {
            			throw 'Failed to parse response received from GCP API. Check debug log for more information.';
            		}
            	}
            
            	if (typeof response !== 'object' || response === null) {
            		throw 'Cannot process response data: received data is not an object. Check debug log for more information.';
            	}
            
            	if (request.getStatus() !== 200) {
            		if (typeof (response.error && response.error.message) !== 'undefined') {
            			throw response.error.message;
            		}
            		else {
            			throw 'Failed to receive data: invalid response status code. Check debug log for more information.';
            		}
            	}
            	return response;
            };
            
            function rawMap(raw, prefix) {
            	var keys = getField(raw, 'timeSeriesDescriptor.pointDescriptors'),
            		values = getField(raw, 'timeSeriesData.0.pointData.0.values'),
            		re = /(^t_\d+\.value\.)/g;
            
            	for (i in keys) {
            		var key = getField(keys[i], 'key').replace(re, ''),
            			value_types = ['int64Value', 'doubleValue', 'stringValue', 'boolValue'];
            
            		for (v in value_types) {
            			if (typeof values[i][value_types[v]] !== 'undefined') {
            				if (prefix) {
            					obj[prefix + key] = values[i][value_types[v]];
            				}
            				else {
            					obj[key] = values[i][value_types[v]];
            				}
            
            			}
            		}
            	}
            	return obj;
            }
            
            var params = checkParams(JSON.parse(value)),
            	j_filter = ' | within ' + params.time_window + " | filter database_id = '" + params.database_id + "'" + ' | join',
            	url = 'https://monitoring.googleapis.com/v3/projects/' + params.project_id + '/timeSeries:query',
            	queries = [
            		{ name: 'base_', data: { query: '{' + base_paths.join(';') + '}' + j_filter } },
            		{ name: 'mysql_', data: { query: '{' + mysql_paths.join(';') + '}' + j_filter } }
            	];
            
            for (q in queries) {
            	raw = getHttpData(url, params.token, queries[q].data);
            	obj = Object.assign(obj, rawMap(raw, queries[q].name));
            }
            
            obj.base_ram_pused = Math.floor(getField(obj, 'base_usage') / getField(obj, 'base_quota') * 100);
            
            return JSON.stringify(obj);
          description: 'MySQL metrics in raw format.'
          preprocessing:
            - type: CHECK_NOT_SUPPORTED
              parameters:
                - ''
          timeout: '{$GCP.DATA.TIMEOUT}'
          parameters:
            - name: database_id
              value: '{$GCP.PROJECT.ID}:{HOST.NAME}'
            - name: project_id
              value: '{$GCP.PROJECT.ID}'
            - name: proxy
              value: '{$GCP.PROXY}'
            - name: time_window
              value: '{$GCP.TIME.WINDOW}'
            - name: token
              value: '{$GCP.AUTH.TOKEN}'
          tags:
            - tag: component
              value: raw
        - uuid: 9ddae405a9b343759d03b5b29c469d18
          name: 'GCP Cloud SQL MySQL: Connections'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.network.connections
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Number of connections to the databases on the Cloud SQL instance.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_connections
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: connections
            - tag: component
              value: network
        - uuid: d970d8e209df4b2a810c2e59f39fa429
          name: 'GCP Cloud SQL MySQL: Network: Received bytes'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.network.received_bytes_count
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Delta count of bytes received through the network.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_received_bytes_count
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: network
            - tag: component
              value: traffic
        - uuid: 977e4e22ebfc4a19a228a8935d9a342c
          name: 'GCP Cloud SQL MySQL: Network: Sent bytes'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.network.sent_bytes_count
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Delta count of bytes sent through the network.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.base_sent_bytes_count
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: network
            - tag: component
              value: traffic
        - uuid: 1d651976f70944acb31cd0430e70d422
          name: 'GCP Cloud SQL MySQL: Open tables'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.open_tables
          delay: '0'
          history: 7d
          trends: 90d
          description: 'The number of tables that are currently open.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_open_tables
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: tables
        - uuid: 1606766c63bf4aa1ade24a34650eef05
          name: 'GCP Cloud SQL MySQL: Open table definitions'
          type: DEPENDENT
          key: gcp.cloudsql.mysql.open_table_definitions
          delay: '0'
          history: 7d
          trends: 90d
          description: 'The number of table definitions that are currently cached.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_open_table_definitions
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: tables
        - uuid: 3d3ec2e37bf94fb68c40967b56dfd95c
          name: 'GCP Cloud SQL MySQL: Network: Bytes received by MySQL'
          type: DEPENDENT
          key: gcp.cloudsql.mysql_received_bytes_count
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Delta count of bytes received by MySQL process.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_received_bytes_count
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: network
            - tag: component
              value: traffic
        - uuid: f926beb31be44dc0bfb30c571fac280a
          name: 'GCP Cloud SQL MySQL: Network: Bytes sent by MySQL'
          type: DEPENDENT
          key: gcp.cloudsql.mysql_sent_bytes_count
          delay: '0'
          history: 7d
          trends: 90d
          units: B
          description: 'Delta count of bytes sent by MySQL process.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_sent_bytes_count
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: network
            - tag: component
              value: traffic
        - uuid: bbdeb595ab1b44d7a332fbf0c2637403
          name: 'GCP Cloud SQL MySQL: Queries'
          type: DEPENDENT
          key: gcp.cloudsql.queries
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta of statements executed by the server.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_queries
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: queries
        - uuid: 114fb26dcdc1441c84c150c7809b3400
          name: 'GCP Cloud SQL MySQL: Questions'
          type: DEPENDENT
          key: gcp.cloudsql.questions
          delay: '0'
          history: 7d
          trends: 90d
          description: 'Delta of statements executed by the server sent by the client.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.mysql_questions
          master_item:
            key: gcp.cloudsql.mysql.metrics.get
          tags:
            - tag: component
              value: queries
      tags:
        - tag: class
          value: cloud
        - tag: target
          value: cloudsql
        - tag: target
          value: gcp
        - tag: target
          value: google-cloud-platform
        - tag: target
          value: mysql
      macros:
        - macro: '{$CLOUD_SQL.MYSQL.CPU.UTIL.MAX}'
          value: '95'
          description: 'GCP Cloud SQL MySQL instance CPU usage threshold.'
        - macro: '{$CLOUD_SQL.MYSQL.DISK.UTIL.CRIT}'
          value: '90'
          description: 'GCP Cloud SQL MySQL instance critical disk usage threshold.'
        - macro: '{$CLOUD_SQL.MYSQL.DISK.UTIL.WARN}'
          value: '80'
          description: 'GCP Cloud SQL MySQL instance warning disk usage threshold.'
        - macro: '{$CLOUD_SQL.MYSQL.RAM.UTIL.MAX}'
          value: '90'
          description: 'GCP Cloud SQL MySQL instance RAM usage threshold.'
        - macro: '{$GCP.DATA.TIMEOUT}'
          value: 15s
          description: 'A response timeout for an API.'
        - macro: '{$GCP.PROXY}'
          description: 'Sets HTTP proxy value. If this macro is empty then no proxy is used.'
        - macro: '{$GCP.TIME.WINDOW}'
          value: 5m
          description: |
            Time interval for the data requests.
            Supported usage type:
            1. The default update interval for most of the items.
            2. The minimal time window for the data requested in the Monitoring Query Language REST API request.
      dashboards:
        - uuid: 5932cc56f6f146db8fac121b3817a407
          name: 'MySQL instance'
          pages:
            - name: 'MySQL instance'
              widgets:
                - type: GRAPH_CLASSIC
                  width: '12'
                  height: '5'
                  fields:
                    - type: ITEM
                      name: itemid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        key: gcp.cloudsql.mysql.cpu.usage_time
                    - type: INTEGER
                      name: source_type
                      value: '1'
                - type: GRAPH_CLASSIC
                  'y': '5'
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        name: 'GCP Cloud SQL MySQL: Memory usage'
                - type: GRAPH_CLASSIC
                  'y': '10'
                  width: '12'
                  height: '5'
                  fields:
                    - type: ITEM
                      name: itemid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        key: gcp.cloudsql.mysql.disk.utilization
                    - type: INTEGER
                      name: source_type
                      value: '1'
                - type: GRAPH_CLASSIC
                  'y': '15'
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        name: 'GCP Cloud SQL MySQL: Network traffic'
                - type: GRAPH_CLASSIC
                  'y': '20'
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        name: 'GCP Cloud SQL MySQL: pages'
                - type: GRAPH_CLASSIC
                  x: '12'
                  width: '12'
                  height: '5'
                  fields:
                    - type: ITEM
                      name: itemid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        key: gcp.cloudsql.mysql.cpu.utilization
                    - type: INTEGER
                      name: source_type
                      value: '1'
                - type: GRAPH_CLASSIC
                  x: '12'
                  'y': '5'
                  width: '12'
                  height: '5'
                  fields:
                    - type: ITEM
                      name: itemid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        key: gcp.cloudsql.mysql.memory.utilization
                    - type: INTEGER
                      name: source_type
                      value: '1'
                - type: GRAPH_CLASSIC
                  x: '12'
                  'y': '10'
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        name: 'GCP Cloud SQL MySQL: Disk read/write operations'
                - type: GRAPH_CLASSIC
                  x: '12'
                  'y': '15'
                  width: '12'
                  height: '5'
                  fields:
                    - type: ITEM
                      name: itemid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        key: gcp.cloudsql.mysql.network.connections
                    - type: INTEGER
                      name: source_type
                      value: '1'
                - type: GRAPH_CLASSIC
                  x: '12'
                  'y': '20'
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'GCP Cloud SQL MySQL by HTTP'
                        name: 'GCP Cloud SQL MySQL: Queries'
      valuemaps:
        - uuid: 8aa36f0f6a0b42a3b5e0eabfb700e8db
          name: 'Database availability'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: 9adad9dad34646d79bcc6c414ddf8afe
          name: 'Instance state'
          mappings:
            - value: '0'
              newvalue: Running
            - value: '1'
              newvalue: Suspended
            - value: '2'
              newvalue: Runnable
            - value: '3'
              newvalue: 'Pending create'
            - value: '4'
              newvalue: Maintenance
            - value: '5'
              newvalue: Failed
            - value: '6'
              newvalue: 'Unknown state'
            - value: '10'
              newvalue: 'Data retrievement error'
  graphs:
    - uuid: 935c2f388185469f82100541d9efb2c7
      name: 'GCP Cloud SQL MySQL: Disk read/write operations'
      graph_items:
        - color: 199C0D
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.disk.read_ops_count
        - sortorder: '1'
          color: F63100
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.disk.write_ops_count
    - uuid: 1b0ea2b38fe740b197ecbcfdd7464b02
      name: 'GCP Cloud SQL MySQL: Disk usage'
      graph_items:
        - drawtype: BOLD_LINE
          color: 199C0D
          calc_fnc: MIN
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.disk.quota
        - sortorder: '1'
          drawtype: GRADIENT_LINE
          color: F63100
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.disk.bytes_used
    - uuid: 4378be58ccff4592a1b54838b90e9ea8
      name: 'GCP Cloud SQL MySQL: Memory usage'
      graph_items:
        - drawtype: BOLD_LINE
          color: 199C0D
          calc_fnc: MIN
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.memory.quota
        - sortorder: '1'
          drawtype: GRADIENT_LINE
          color: F63100
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.memory.usage
    - uuid: c23964e5e54541ccb3c8b7b5f5a4b24d
      name: 'GCP Cloud SQL MySQL: Network traffic'
      type: STACKED
      graph_items:
        - color: 199C0D
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.network.received_bytes_count
        - sortorder: '1'
          color: F63100
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.network.sent_bytes_count
    - uuid: e680755183ec4927893e03f8d83bc0f2
      name: 'GCP Cloud SQL MySQL: pages'
      graph_items:
        - color: 199C0D
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.innodb_buffer_pool_pages_free
        - sortorder: '1'
          color: F63100
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.innodb_buffer_pool_pages_dirty
        - sortorder: '2'
          color: 00611C
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.innodb_buffer_pool_pages_total
        - sortorder: '3'
          color: F7941D
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.innodb_pages_read
        - sortorder: '4'
          color: FC6EA3
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.mysql.innodb_pages_written
    - uuid: e447dd13336446b1a965e92d7ddeaf96
      name: 'GCP Cloud SQL MySQL: Queries'
      graph_items:
        - color: 199C0D
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.queries
        - sortorder: '1'
          color: F63100
          item:
            host: 'GCP Cloud SQL MySQL by HTTP'
            key: gcp.cloudsql.questions
