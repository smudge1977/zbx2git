zabbix_export:
  version: '6.0'
  date: '2024-08-25T12:32:23Z'
  groups:
    - uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    - uuid: cbaf0383cb934294ac53a28ddfd49434
      template: 'Linux filesystems by SNMP'
      name: 'Linux filesystems by SNMP'
      description: |
        MIBs used:
        HOST-RESOURCES-MIB
        UCD-SNMP-MIB
        
        Generated by official Zabbix template tool "Templator"
      groups:
        - name: Templates/Modules
      discovery_rules:
        - uuid: c55b2f96bd50421482dfcc230e6de01e
          name: 'Mounted filesystem discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#FSNAME},1.3.6.1.2.1.25.2.3.1.3,{#FSTYPE},1.3.6.1.2.1.25.2.3.1.2,{#ALLOC_UNITS},1.3.6.1.2.1.25.2.3.1.4]'
          key: 'vfs.fs.discovery[snmp]'
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.MATCHES}'
                formulaid: A
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.MATCHES}'
                formulaid: C
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
          description: 'HOST-RESOURCES-MIB::hrStorage discovery with storage filter'
          item_prototypes:
            - uuid: 5c0b2605afe84c288207c04b9946dfbf
              name: '{#FSNAME}: Free inodes in %'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2021.9.1.10["index","1.3.6.1.4.1.2021.9.1.2", "{#FSNAME}"]'
              key: 'vfs.fs.inode.pfree[dskPercentNode.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: '%'
              description: |
                MIB: UCD-SNMP-MIB
                If having problems collecting this item make sure access to UCD-SNMP-MIB is allowed.
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - 'return (100-value);'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
              trigger_prototypes:
                - uuid: 377f4ffa529f4b0690a11228f4021294
                  expression: 'min(/Linux filesystems by SNMP/vfs.fs.inode.pfree[dskPercentNode.{#SNMPINDEX}],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  name: '{#FSNAME}: Running out of free inodes'
                  event_name: '{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: |
                    It may become impossible to write to a disk if there are no index nodes left.
                    The following error messages may be returned as symptoms, even though the free space is available:
                    - 'No space left on device';
                    - 'Disk is full'.
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: performance
                - uuid: 5f80199affa44ed7a6b875c49ca00aa7
                  expression: 'min(/Linux filesystems by SNMP/vfs.fs.inode.pfree[dskPercentNode.{#SNMPINDEX}],5m)<{$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}'
                  name: '{#FSNAME}: Running out of free inodes'
                  event_name: '{#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    It may become impossible to write to a disk if there are no index nodes left.
                    The following error messages may be returned as symptoms, even though the free space is available:
                    - 'No space left on device';
                    - 'Disk is full'.
                  dependencies:
                    - name: '{#FSNAME}: Running out of free inodes'
                      expression: 'min(/Linux filesystems by SNMP/vfs.fs.inode.pfree[dskPercentNode.{#SNMPINDEX}],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: performance
            - uuid: 3cc99f32a3a44b2a94c2bab5f2765c8e
              name: '{#FSNAME}: Space utilization'
              type: CALCULATED
              key: 'vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: '%'
              params: '(last(//vfs.fs.used[hrStorageUsed.{#SNMPINDEX}])/last(//vfs.fs.total[hrStorageSize.{#SNMPINDEX}]))*100'
              description: 'The space utilization expressed in % for {#FSNAME}.'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
              trigger_prototypes:
                - uuid: ae3535ef3f674dccb6c809dc7d01172c
                  expression: 'last(/Linux filesystems by SNMP/vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}])>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}'
                  name: '{#FSNAME}: Disk space is critically low'
                  event_name: '{#FSNAME}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%)'
                  opdata: 'Space used: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'The volume''s space usage exceeds the `{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}` limit.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: capacity
                - uuid: 3bef4897bcd549288203241c5ca9f017
                  expression: 'last(/Linux filesystems by SNMP/vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}])>{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}'
                  name: '{#FSNAME}: Disk space is low'
                  event_name: '{#FSNAME}: Disk space is low (used > {$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%)'
                  opdata: 'Space used: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The volume''s space usage exceeds the `{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}` limit.'
                  manual_close: 'YES'
                  dependencies:
                    - name: '{#FSNAME}: Disk space is critically low'
                      expression: 'last(/Linux filesystems by SNMP/vfs.fs.pused[storageUsedPercentage.{#SNMPINDEX}])>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: capacity
            - uuid: 9e9b2eb864164eebb4825ba0331b0b95
              name: '{#FSNAME}: Total space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vfs.fs.total[hrStorageSize.{#SNMPINDEX}]'
              history: 7d
              units: B
              description: |
                MIB: HOST-RESOURCES-MIB
                The size of the storage represented by this entry, in units of hrStorageAllocationUnits.
                This object is writable to allow remote configuration of the size of the storage area in those cases where such an operation makes sense and is possible on the underlying system.
                For example, the amount of main storage allocated to a buffer pool might be modified or the amount of disk space allocated to virtual storage might be modified.
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '{#ALLOC_UNITS}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
            - uuid: 2cfbdae09907476ea6d73af86338f279
              name: '{#FSNAME}: Used space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vfs.fs.used[hrStorageUsed.{#SNMPINDEX}]'
              history: 7d
              units: B
              description: |
                MIB: HOST-RESOURCES-MIB
                The amount of the storage represented by this entry that is allocated, in units of hrStorageAllocationUnits.
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '{#ALLOC_UNITS}'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
          graph_prototypes:
            - uuid: f1000d7a017f4954a32103b345ae4fdf
              name: '{#FSNAME}: Disk space usage'
              width: '600'
              height: '340'
              type: PIE
              show_3d: 'YES'
              graph_items:
                - color: '969696'
                  calc_fnc: LAST
                  type: GRAPH_SUM
                  item:
                    host: 'Linux filesystems by SNMP'
                    key: 'vfs.fs.total[hrStorageSize.{#SNMPINDEX}]'
                - sortorder: '1'
                  color: C80000
                  calc_fnc: LAST
                  item:
                    host: 'Linux filesystems by SNMP'
                    key: 'vfs.fs.used[hrStorageUsed.{#SNMPINDEX}]'
      macros:
        - macro: '{$VFS.FS.FSNAME.MATCHES}'
          value: .+
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        - macro: '{$VFS.FS.FSNAME.NOT_MATCHES}'
          value: ^(/dev|/sys|/run|/proc|.+/shm$)
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        - macro: '{$VFS.FS.FSTYPE.MATCHES}'
          value: '.*(\.4|\.9|hrStorageFixedDisk|hrStorageFlashMemory)$'
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        - macro: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
          value: ^\s$
          description: 'This macro is used in filesystems discovery. Can be overridden on the host or linked template level'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.CRIT}'
          value: '10'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.WARN}'
          value: '20'
        - macro: '{$VFS.FS.PUSED.MAX.CRIT}'
          value: '90'
        - macro: '{$VFS.FS.PUSED.MAX.WARN}'
          value: '80'
      dashboards:
        - uuid: dd47dc78781c49b5b2a6041e10a68801
          name: Filesystems
          pages:
            - name: Overview
              widgets:
                - type: GRAPH_PROTOTYPE
                  width: '2'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: 'Linux filesystems by SNMP'
                        name: '{#FSNAME}: Disk space usage'
